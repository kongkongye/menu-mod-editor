window.Menu=(function(){var WHITE_SPACE=/^\s+$/;var mode="nerd";var toggleMode=function(){if(mode==="nerd"){mode="laic"}else{mode="nerd"}Xonomy.setMode(mode)};toggleMode();var convertXmlDocumentToString=function(xmlDocument){return $("<div></div>").append($(xmlDocument.documentElement)).html()};var formatXml=function(xml){var formatted="";var reg=/(>)(<)(\/*)/g;xml=xml.replace(reg,"$1\r\n$2$3");var pad=0;jQuery.each(xml.split("\r\n"),function(index,node){var indent=0;if(node.match(/.+<\/\w[^>]*>$/)){indent=0}else{if(node.match(/^<\/\w/)){if(pad!=0){pad-=1}}else{if(node.match(/^<\w[^>]*[^\/]>.*$/)){indent=1}else{indent=0}}}var padding="";for(var i=0;i<pad;i++){padding+="  "}formatted+=padding+node+"\r\n";pad+=indent});return formatted};var importFix=function(document,node){for(var i=0;i<node.childNodes.length;i++){var current=node.childNodes[i];if(current.nodeType===3){if(WHITE_SPACE.test(current.nodeValue)){node.removeChild(current);i--;continue}if(current.parentNode.nodeName==="line"){var textNode=document.createElement("text");textNode.appendChild(document.createTextNode(current.nodeValue));node.replaceChild(textNode,current)}continue}if(current.nodeType===1){importFix(document,current);continue}}};var exportFix=function(node){var i;if(node.nodeType===1){if(node.nodeName==="menu"){node.setAttribute("xmlns","http://xsd.kongkongye.com/menu.xsd")}node.removeAttribute("xml:space");for(i=0;i<node.childNodes.length;i++){exportFix(node.childNodes[i])}}else{if(node.nodeType===9){for(i=0;i<node.childNodes.length;i++){exportFix(node.childNodes[i])}}}};$("#import").click(function(){try{var value=$("#in").val();var xmlDocument=$.parseXML(value);Menu.importFix(xmlDocument,xmlDocument);Xonomy.render(xmlDocument,$("#container")[0],docSpec)}catch(e){console.log(e);alert(use(10))}});$("#export").click(function(){var value=Xonomy.harvest();var xmlDocument=$.parseXML(value);Menu.exportFix(xmlDocument);$("#out").text(Menu.formatXml(Menu.convertXmlDocumentToString(xmlDocument)));$("#select").attr("disabled",false)});$("#select").click(function(){$("#out").select()});$("#toggle").click(function(){Menu.toggleMode()});$(function(){$("#in").val("<menu title=''></menu>");$("#import").click()});var origin=docSpec.onchange;docSpec.onchange=function(){origin();$("#select").attr("disabled",true)};return{convertXmlDocumentToString:convertXmlDocumentToString,formatXml:formatXml,importFix:importFix,exportFix:exportFix,toggleMode:toggleMode,}})();